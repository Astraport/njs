var fxs = require( '../index' )
	, path = require( 'path' );

exports['address-in-use'] = function( test )
{
	test.expect( 3 );
	//start with a non-privileged configuration
	var server = fxs.start( path.join( __dirname, "non-privileged.json" ) );
	server.on( "connected", function( port, host )
	{
		test.ok( port === 8043 );
		test.ok( server.connected );
		console.log( "fxs-test: server connected to %j:%j", host, port );
		
		var duplicate = fxs.start( path.join( __dirname, "non-privileged.json" ) );	
		duplicate.on( "error", function( err )
		{
			console.log( "fxs-test: error %j", err );
			test.throws( function(){ throw err; } );			
			server.close();
			test.done();
		} );
	} );
}