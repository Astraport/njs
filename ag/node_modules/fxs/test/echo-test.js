var fxs = require( '../index' )
	, path = require( 'path' );

exports['echo-non-privileged-port'] = function( test )
{
	test.expect( 2 );
	var message = "i can hear an echo";
	//start with a non-privileged configuration
	var server = fxs.start( path.join( __dirname, "non-privileged.json" ) );
	server.on( "connected", function( port, host )
	{
		test.ok( port === 8043 );
		console.log( "fxs-test: server connected to %j:%j", host, port );
		//send a policy file request to the server
		var client = fxs.client( port, host );
		client.on( "echo", function( contents )
		{
			test.ok( contents === message );
			console.log( "fxs-test: echo response %j", contents );
			server.close();
			test.done();
		} );
		client.send( message );
	} );
}