var fxs = require( '../index' )
	, path = require( 'path' );

exports['send-non-privileged-port'] = function( test )
{
	test.expect( 2 );
	//start with a non-privileged configuration
	var server = fxs.start( path.join( __dirname, "non-privileged.json" ) );
	server.on( "connected", function( port, host )
	{
		test.ok( port === 8043 );
		test.ok( server.connected );		
		console.log( "fxs-test: server connected to %j:%j", host, port );
		
		//send a policy file request to the server
		var client = fxs.ping( 8043 );
		client.on( "policy", function( contents )
		{
			console.log( "fxs-test: client received policy file %j", contents );
			server.close();
			test.done();
		} );
	} );
}